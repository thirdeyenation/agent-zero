<html>
  <head>
    <title>Chat Model</title>
  </head>

  <body>
    <div x-data>
      <template x-if="$store.settings.settings">
        <div>
          <div class="section-title">Chat Model</div>
          <div class="section-description">
            Selection and settings for main chat model used by Agent Zero
          </div>

          <div class="field">
            <div class="field-label">
              <div class="field-title">Chat model provider</div>
              <div class="field-description">Select provider for main chat model used by Agent Zero</div>
            </div>
            <div class="field-control">
              <select x-model="$store.settings.settings.chat_model_provider">
                <template x-for="option in $store.settings.additional?.chat_providers" :key="option.value">
                  <option :value="option.value" :selected="option.value === $store.settings.settings.chat_model_provider" x-text="option.label"></option>
                </template>
              </select>
            </div>
          </div>

          <div class="field">
            <div class="field-label">
              <div class="field-title">Chat model name</div>
              <div class="field-description">Exact name of model from selected provider</div>
            </div>
            <div class="field-control">
              <input type="text" x-model="$store.settings.settings.chat_model_name" />
            </div>
          </div>

          <div class="field">
            <div class="field-label">
              <div class="field-title">API key</div>
              <div class="field-description">API key for the selected chat model provider</div>
            </div>
            <div class="field-control">
              <input
                type="text"
                x-model="$store.settings.settings.api_keys[$store.settings.settings.chat_model_provider]"
                autocomplete="off"
              />
            </div>
          </div>

          <div class="field">
            <div class="field-label">
              <div class="field-title">Chat model API base URL</div>
              <div class="field-description">
                API base URL for main chat model. Leave empty for default. Only relevant for Azure, local and custom (other) providers.
              </div>
            </div>
            <div class="field-control">
              <input type="text" x-model="$store.settings.settings.chat_model_api_base" />
            </div>
          </div>

          <div class="field">
            <div class="field-label">
              <div class="field-title">Chat model context length</div>
              <div class="field-description">
                Maximum number of tokens in the context window for LLM. System prompt, chat history, RAG and response all count towards this limit.
              </div>
            </div>
            <div class="field-control">
              <input type="number" x-model.number="$store.settings.settings.chat_model_ctx_length" />
            </div>
          </div>

          <div class="field">
            <div class="field-label">
              <div class="field-title">Context window space for chat history</div>
              <div class="field-description">
                Portion of context window dedicated to chat history visible to the agent. Chat history will automatically be optimized to fit. Smaller size will result in shorter and more summarized history. The remaining space will be used for system prompt, RAG and response.
              </div>
            </div>
            <div class="field-control">
              <input
                type="range"
                min="0.01"
                max="1"
                step="0.01"
                x-model.number="$store.settings.settings.chat_model_ctx_history"
              />
              <span class="range-value" x-text="$store.settings.settings.chat_model_ctx_history"></span>
            </div>
          </div>

          <div class="field">
            <div class="field-label">
              <div class="field-title">Supports Vision</div>
              <div class="field-description">
                Models capable of Vision can for example natively see the content of image attachments.
              </div>
            </div>
            <div class="field-control">
              <label class="toggle">
                <input type="checkbox" x-model="$store.settings.settings.chat_model_vision" />
                <span class="toggler"></span>
              </label>
            </div>
          </div>

          <div class="field">
            <div class="field-label">
              <div class="field-title">Requests per minute limit</div>
              <div class="field-description">
                Limits the number of requests per minute to the chat model. Waits if the limit is exceeded. Set to 0 to disable rate limiting.
              </div>
            </div>
            <div class="field-control">
              <input type="number" x-model.number="$store.settings.settings.chat_model_rl_requests" />
            </div>
          </div>

          <div class="field">
            <div class="field-label">
              <div class="field-title">Input tokens per minute limit</div>
              <div class="field-description">
                Limits the number of input tokens per minute to the chat model. Waits if the limit is exceeded. Set to 0 to disable rate limiting.
              </div>
            </div>
            <div class="field-control">
              <input type="number" x-model.number="$store.settings.settings.chat_model_rl_input" />
            </div>
          </div>

          <div class="field">
            <div class="field-label">
              <div class="field-title">Output tokens per minute limit</div>
              <div class="field-description">
                Limits the number of output tokens per minute to the chat model. Waits if the limit is exceeded. Set to 0 to disable rate limiting.
              </div>
            </div>
            <div class="field-control">
              <input type="number" x-model.number="$store.settings.settings.chat_model_rl_output" />
            </div>
          </div>

          <div class="field field-full">
            <div class="field-label">
              <div class="field-title">Chat model additional parameters</div>
              <div class="field-description">
                Any other parameters supported by <a href='https://docs.litellm.ai/docs/set_keys' target='_blank'>LiteLLM</a>. Format is KEY=VALUE on individual lines, like .env file. Value can also contain JSON objects - when unquoted, it is treated as object, number etc., when quoted, it is treated as string.
              </div>
            </div>
            <div class="field-control">
              <textarea x-model="$store.settings.settings.chat_model_kwargs"></textarea>
            </div>
          </div>
        </div>
      </template>
    </div>
  </body>
</html>
