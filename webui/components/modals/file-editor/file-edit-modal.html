<html>
<head>
  <title>File Editor</title>
  <script type="module">
    import { store } from "/components/modals/file-editor/file-editor-store.js";
  </script>
</head>
<body>
  <div x-data>
    <template x-if="$store.fileEditor">
      <div class="file-edit-modal-root">
        <template x-if="$store.fileEditor.isEditLoading">
          <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>Loading file…</p>
          </div>
        </template>

        <template x-if="$store.fileEditor.editError">
          <div class="error-state">
            <p class="error-message" x-text="$store.fileEditor.editError"></p>
          </div>
        </template>

        <template x-if="!$store.fileEditor.isEditLoading && !$store.fileEditor.editError">
          <div class="file-edit-content">
            <div class="file-edit-meta">
              <div class="file-edit-field">
                <label>File name</label>
                <input
                  type="text"
                  x-model="$store.fileEditor.editFileName"
                  @input="$store.fileEditor.updateEditorMode()"
                  :disabled="!$store.fileEditor.editIsNew"
                />
                <template x-if="$store.fileEditor.editSaveError">
                  <p class="file-edit-inline-error" x-text="$store.fileEditor.editSaveError"></p>
                </template>
              </div>
              <div class="file-edit-path" x-text="$store.fileEditor.editPathLabel()"></div>
            </div>
            <div id="file-editor-container"></div>
          </div>
        </template>
      </div>
    </template>
  </div>

  <template x-if="$store.fileEditor">
    <div class="modal-footer" data-modal-footer>
      <button class="btn btn-cancel" @click="$store.fileEditor.closeFileEditor()" :disabled="$store.fileEditor.isSaving">Cancel</button>
      <button
        class="btn btn-ok"
        @click="$store.fileEditor.saveFileEdits()"
        :disabled="$store.fileEditor.isSaving || $store.fileEditor.isEditLoading || $store.fileEditor.editError"
        x-text="$store.fileEditor.isSaving ? 'Saving…' : 'Save'"
      ></button>
    </div>
  </template>

  <style>
    .file-edit-modal-root {
      display: flex;
      flex-direction: column;
      width: 100%;
      min-height: 400px;
    }

    .file-edit-content {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      margin: 1rem;
    }

    .file-edit-meta {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .file-edit-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .file-edit-field label {
      font-weight: 600;
      color: var(--color-text);
    }

    .file-edit-field input {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid var(--color-border);
      background: var(--color-background);
      color: var(--color-text);
    }

    .file-edit-field input:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .file-edit-inline-error {
      margin: 0;
      color: var(--color-error);
      font-weight: 500;
      font-size: 0.85rem;
    }

    .file-edit-path {
      font-size: 0.85rem;
      color: var(--color-text-secondary);
      word-break: break-all;
    }

    #file-editor-container {
      width: 100%;
      min-height: 55vh;
      border-radius: 0.4rem;
      overflow: auto;
      scrollbar-gutter: stable;
      scrollbar-width: thin;
    }

    #file-editor-container::-webkit-scrollbar {
      width: 8px;
    }

    .ace_scrollbar-v {
      overflow-y: auto;
    }

    .loading-state,
    .error-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-lg);
      min-height: 200px;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--color-border);
      border-top: 3px solid var(--color-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: var(--spacing-md);
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-message {
      color: var(--color-error);
      font-weight: 500;
      margin: 0;
    }
  </style>
</body>
</html>
