<html>
<head>
    <title>Task Details</title>
    <script type="module">
        import { store } from "/components/modals/scheduler/scheduler-store.js";
    </script>
</head>
<body>
<div x-data>
    <template x-if="$store.schedulerStore">
        <div class="scheduler-detail-view"
             x-show="$store.schedulerStore.selectedTaskForDetail">
            <div class="scheduler-detail-header">
                <div class="scheduler-detail-header-left">
                    <h2 class="scheduler-detail-title"
                        x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.selectedTaskForDetail.name : ''"></h2>
                    <div class="scheduler-status-badge"
                         :class="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.getStateBadgeClass($store.schedulerStore.selectedTaskForDetail.state) : ''"
                         x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.selectedTaskForDetail.state : ''"></div>
                </div>
                <div class="scheduler-detail-header-actions">
                    <button class="btn btn-action-header" 
                            @click="$store.schedulerStore.runTask($store.schedulerStore.selectedTaskForDetail.uuid)"
                            title="Run Task">
                        <span class="material-symbols-outlined">play_arrow</span>
                    </button>
                    <button class="btn btn-action-header" 
                            @click="$store.schedulerStore.editFromDetail()"
                            title="Edit Task">
                        <span class="material-symbols-outlined">edit</span>
                    </button>
                    <button class="btn btn-action-header danger" 
                            @click="$store.schedulerStore.deleteFromDetail()"
                            title="Delete Task">
                        <span class="material-symbols-outlined">delete</span>
                    </button>
                    <button class="btn btn-cancel" @click="$store.schedulerStore.closeTaskDetail()">Close</button>
                </div>
            </div>

            <div class="scheduler-detail-content">
                <div class="scheduler-details-grid">
                    <div class="scheduler-details-label">Type:</div>
                    <div class="scheduler-details-value"
                         x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.selectedTaskForDetail.type : ''"></div>

                    <div class="scheduler-details-label">Project:</div>
                    <div class="scheduler-details-value">
                        <span class="project-color-ball"
                              :style="$store.schedulerStore.extractTaskProject($store.schedulerStore.selectedTaskForDetail)?.color ? { backgroundColor: $store.schedulerStore.extractTaskProject($store.schedulerStore.selectedTaskForDetail).color } : { border: '1px solid var(--color-border)' }"></span>
                        <span x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.formatTaskProject($store.schedulerStore.selectedTaskForDetail) : 'No Project'"></span>
                    </div>

                    <div class="scheduler-details-label">Created:</div>
                    <div class="scheduler-details-value"
                         x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.formatDate($store.schedulerStore.selectedTaskForDetail.created_at) : ''"></div>

                    <div class="scheduler-details-label">Last Updated:</div>
                    <div class="scheduler-details-value"
                         x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.formatDate($store.schedulerStore.selectedTaskForDetail.updated_at) : ''"></div>

                    <div class="scheduler-details-label">Last Run:</div>
                    <div class="scheduler-details-value"
                         x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.formatDate($store.schedulerStore.selectedTaskForDetail.last_run) : ''"></div>

                    <div class="scheduler-details-label"
                         x-show="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.type === 'scheduled'">
                        Schedule:</div>
                    <div class="scheduler-details-value"
                         x-show="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.type === 'scheduled'"
                         x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.formatSchedule($store.schedulerStore.selectedTaskForDetail) : ''">
                    </div>

                    <div class="scheduler-details-label"
                         x-show="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.type === 'adhoc'">
                        Token:</div>
                    <div class="scheduler-details-value"
                         x-show="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.type === 'adhoc'"
                         x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.selectedTaskForDetail.token : ''"></div>

                    <div class="scheduler-details-label"
                         x-show="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.type === 'planned'">
                        Plan:</div>
                    <div class="scheduler-details-value"
                         x-show="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.type === 'planned'">
                        <div x-show="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.plan">
                            <div><strong>Upcoming:</strong></div>
                            <template x-if="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.plan && $store.schedulerStore.selectedTaskForDetail.plan.todo && $store.schedulerStore.selectedTaskForDetail.plan.todo.length > 0">
                                <div>
                                    <template x-for="(time, index) in $store.schedulerStore.selectedTaskForDetail.plan.todo" :key="index">
                                        <div x-text="$store.schedulerStore.formatDate(time)"></div>
                                    </template>
                                </div>
                            </template>
                            <template x-if="!$store.schedulerStore.selectedTaskForDetail || !$store.schedulerStore.selectedTaskForDetail.plan || !$store.schedulerStore.selectedTaskForDetail.plan.todo || $store.schedulerStore.selectedTaskForDetail.plan.todo.length === 0">
                                <div>No upcoming executions</div>
                            </template>

                            <div><strong>In Progress:</strong></div>
                            <div
                                x-text="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.plan && $store.schedulerStore.selectedTaskForDetail.plan.in_progress ? $store.schedulerStore.formatDate($store.schedulerStore.selectedTaskForDetail.plan.in_progress) : 'None'"></div>

                            <div><strong>Completed:</strong></div>
                            <template x-if="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.plan && $store.schedulerStore.selectedTaskForDetail.plan.done && $store.schedulerStore.selectedTaskForDetail.plan.done.length > 0">
                                <div>
                                    <template x-for="(time, index) in $store.schedulerStore.selectedTaskForDetail.plan.done" :key="index">
                                        <div x-text="$store.schedulerStore.formatDate(time)"></div>
                                    </template>
                                </div>
                            </template>
                            <template x-if="!$store.schedulerStore.selectedTaskForDetail || !$store.schedulerStore.selectedTaskForDetail.plan || !$store.schedulerStore.selectedTaskForDetail.plan.done || $store.schedulerStore.selectedTaskForDetail.plan.done.length === 0">
                                <div>No completed executions</div>
                            </template>
                        </div>
                    </div>

                    <div class="scheduler-details-label">Last Result:</div>
                    <div class="scheduler-details-value"
                         x-text="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.last_result ? $store.schedulerStore.selectedTaskForDetail.last_result : 'No results yet'"></div>

                    <div class="scheduler-details-label">System Prompt:</div>
                    <div class="scheduler-details-value"
                         x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.selectedTaskForDetail.system_prompt : ''"></div>

                    <div class="scheduler-details-label">User Prompt:</div>
                    <div class="scheduler-details-value"
                         x-text="$store.schedulerStore.selectedTaskForDetail ? $store.schedulerStore.selectedTaskForDetail.prompt : ''"></div>

                    <div class="scheduler-details-label">Attachments:</div>
                    <div class="scheduler-details-value">
                        <template x-if="$store.schedulerStore.selectedTaskForDetail && $store.schedulerStore.selectedTaskForDetail.attachments && $store.schedulerStore.selectedTaskForDetail.attachments.length > 0">
                            <div>
                                <template x-for="(attachment, index) in $store.schedulerStore.selectedTaskForDetail.attachments" :key="index">
                                    <div x-text="attachment"></div>
                                </template>
                            </div>
                        </template>
                        <template x-if="!$store.schedulerStore.selectedTaskForDetail || !$store.schedulerStore.selectedTaskForDetail.attachments || $store.schedulerStore.selectedTaskForDetail.attachments.length === 0">
                            <div>No attachments</div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </template>
</div>

<style>
    .scheduler-detail-header-actions .btn-cancel {
        margin-left: var(--spacing-sm);
    }
</style>

</body>
</html>

