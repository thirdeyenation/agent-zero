<html>
<head>
    <script type="module">
        import { store } from "/components/modals/scheduler/scheduler-store.js";
    </script>
</head>
<body>
<div x-data>
    <template x-if="$store.schedulerStore">
        <div class="scheduler-list-container"
             x-show="!$store.schedulerStore.isCreating && !$store.schedulerStore.isEditing">

            <!-- Filter Header -->
            <div class="filters-header">
                <div class="filter-group-inline filter-type">
                    <label>Type</label>
                    <select x-model="$store.schedulerStore.filterType">
                        <option value="all">All Types</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="adhoc">Ad-hoc</option>
                        <option value="planned">Planned</option>
                    </select>
                </div>

                <div class="filter-group-inline filter-state">
                    <label>State</label>
                    <select x-model="$store.schedulerStore.filterState">
                        <option value="all">All States</option>
                        <option value="idle">Idle</option>
                        <option value="running">Running</option>
                        <option value="disabled">Disabled</option>
                        <option value="error">Error</option>
                    </select>
                </div>

                <button class="btn btn-ok btn-new-task" @click="$store.schedulerStore.startCreateTask()">
                    <span class="material-symbols-outlined">add</span>
                    New Task
                </button>
            </div>

            <!-- Status Bar -->
            <div class="data-status-bar" x-show="!$store.schedulerStore.isLoading">
                <div class="status-info">
                    <span class="status-item">
                        <span class="material-symbols-outlined">schedule</span>
                        Total: <strong x-text="$store.schedulerStore.tasks.length"></strong>
                    </span>
                    <span class="status-separator">•</span>
                    <span class="status-item">
                        Filtered: <strong x-text="$store.schedulerStore.filteredTasks.length"></strong>
                    </span>
                </div>

                <!-- Pagination -->
                <div class="status-pagination" x-show="$store.schedulerStore.totalPages > 1">
                    <button class="btn btn-icon" @click="$store.schedulerStore.prevPage()"
                        :disabled="$store.schedulerStore.currentPage === 1" title="Previous Page">
                        <span class="material-symbols-outlined">chevron_left</span>
                    </button>
                    <div class="page-input-group">
                        <label>Page</label>
                        <input type="number" class="page-input"
                            x-model.number="$store.schedulerStore.currentPage"
                            @change="$store.schedulerStore.goToPage($store.schedulerStore.currentPage)"
                            @keyup.enter="$store.schedulerStore.goToPage($store.schedulerStore.currentPage)"
                            :min="1" :max="$store.schedulerStore.totalPages" />
                        <span class="page-total">of <strong
                                x-text="$store.schedulerStore.totalPages"></strong></span>
                    </div>
                    <button class="btn btn-icon" @click="$store.schedulerStore.nextPage()"
                        :disabled="$store.schedulerStore.currentPage === $store.schedulerStore.totalPages"
                        title="Next Page">
                        <span class="material-symbols-outlined">chevron_right</span>
                    </button>
                </div>
            </div>

            <!-- Empty State -->
            <div class="data-empty-state"
                 x-show="!$store.schedulerStore.isLoading && $store.schedulerStore.filteredTasks.length === 0">
                <div>No tasks found</div>
                <button class="btn btn-ok" @click="$store.schedulerStore.startCreateTask()">
                    <span class="material-symbols-outlined">add</span>
                    Create your first task
                </button>
            </div>

            <!-- Task Table -->
            <div class="data-table-container"
                 x-show="!$store.schedulerStore.isLoading && $store.schedulerStore.paginatedTasks.length > 0">
                <table class="data-table scheduler-task-table">
                    <thead>
                    <tr>
                        <th class="col-name sortable" @click="$store.schedulerStore.changeSort('name')">
                            Name
                            <span class="sort-indicator"
                                  x-show="$store.schedulerStore.sortField === 'name'"
                                  :class="{'desc': $store.schedulerStore.sortDirection === 'desc'}">↑</span>
                        </th>
                        <th class="col-state sortable" @click="$store.schedulerStore.changeSort('state')">
                            State
                            <span class="sort-indicator"
                                  x-show="$store.schedulerStore.sortField === 'state'"
                                  :class="{'desc': $store.schedulerStore.sortDirection === 'desc'}">↑</span>
                        </th>
                        <th class="col-project">Project</th>
                        <th class="col-lastrun sortable" @click="$store.schedulerStore.changeSort('last_run')">
                            Last Run
                            <span class="sort-indicator"
                                  x-show="$store.schedulerStore.sortField === 'last_run'"
                                  :class="{'desc': $store.schedulerStore.sortDirection === 'desc'}">↑</span>
                        </th>
                        <th class="col-actions">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <template x-for="task in $store.schedulerStore.paginatedTasks" :key="task.uuid">
                        <tr @click="$store.schedulerStore.showTaskDetail(task.uuid)">
                            <td class="col-name">
                                <span x-text="task.name"></span>
                            </td>
                            <td class="col-state">
                                <span class="scheduler-status-badge"
                                      :class="$store.schedulerStore.getStateBadgeClass(task.state)"
                                      x-text="task.state"></span>
                            </td>
                            <td class="col-project">
                                <span class="project-color-ball"
                                      :style="$store.schedulerStore.extractTaskProject(task)?.color ? { backgroundColor: $store.schedulerStore.extractTaskProject(task).color } : { border: '1px solid var(--color-border)' }"></span>
                                <span x-text="$store.schedulerStore.formatTaskProject(task)"></span>
                            </td>
                            <td class="col-lastrun" x-text="$store.schedulerStore.formatDate(task.last_run)"></td>
                            <td class="col-actions" @click.stop>
                                <div class="actions-wrapper">
                                    <button class="btn btn-action"
                                            @click="$store.schedulerStore.runTask(task.uuid)" title="Run Task">
                                        <span class="material-symbols-outlined">play_arrow</span>
                                    </button>
                                    <button class="btn btn-action"
                                            @click="$store.schedulerStore.resetTaskState(task.uuid)" title="Reset State">
                                        <span class="material-symbols-outlined">refresh</span>
                                    </button>
                                    <button class="btn btn-action"
                                            @click="$store.schedulerStore.startEditTask(task.uuid)" title="Edit Task">
                                        <span class="material-symbols-outlined">edit</span>
                                    </button>
                                    <button class="btn btn-action delete"
                                            @click="$confirmClick($event, () => $store.schedulerStore.deleteTask(task.uuid))" title="Delete Task">
                                        <span class="material-symbols-outlined">delete</span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </template>
                    </tbody>
                </table>
            </div>

            <!-- Bottom Status Bar (for pagination when table is long) -->
            <div class="data-status-bar data-status-bar-bottom"
                 x-show="!$store.schedulerStore.isLoading && $store.schedulerStore.paginatedTasks.length > 5 && $store.schedulerStore.totalPages > 1">
                <div class="status-info">
                    <span class="status-item">
                        <span class="material-symbols-outlined">schedule</span>
                        Total: <strong x-text="$store.schedulerStore.tasks.length"></strong>
                    </span>
                    <span class="status-separator">•</span>
                    <span class="status-item">
                        Filtered: <strong x-text="$store.schedulerStore.filteredTasks.length"></strong>
                    </span>
                </div>

                <div class="status-pagination">
                    <button class="btn btn-icon" @click="$store.schedulerStore.prevPage()"
                        :disabled="$store.schedulerStore.currentPage === 1" title="Previous Page">
                        <span class="material-symbols-outlined">chevron_left</span>
                    </button>
                    <div class="page-input-group">
                        <label>Page</label>
                        <input type="number" class="page-input"
                            x-model.number="$store.schedulerStore.currentPage"
                            @change="$store.schedulerStore.goToPage($store.schedulerStore.currentPage)"
                            @keyup.enter="$store.schedulerStore.goToPage($store.schedulerStore.currentPage)"
                            :min="1" :max="$store.schedulerStore.totalPages" />
                        <span class="page-total">of <strong
                                x-text="$store.schedulerStore.totalPages"></strong></span>
                    </div>
                    <button class="btn btn-icon" @click="$store.schedulerStore.nextPage()"
                        :disabled="$store.schedulerStore.currentPage === $store.schedulerStore.totalPages"
                        title="Next Page">
                        <span class="material-symbols-outlined">chevron_right</span>
                    </button>
                </div>
            </div>
        </div>
    </template>
</div>

<style>
    /* Scheduler-specific: Container layout */
    .scheduler-list-container {
        display: flex;
        flex-direction: column;
        gap: 0;
    }

    /* Scheduler-specific: New task button positioning */
    .btn-new-task {
        margin-left: auto;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-new-task .material-symbols-outlined {
        font-size: 20px;
    }

    /* Scheduler-specific: Filter select min-width */
    .scheduler-list-container .filter-group-inline select {
        min-width: 120px;
    }

    /* Scheduler-specific: Column widths */
    .scheduler-task-table .col-name { width: 25%; }
    .scheduler-task-table .col-state { width: 12%; }
    .scheduler-task-table .col-project { width: 20%; }
    .scheduler-task-table .col-lastrun { width: 23%; }
    .scheduler-task-table .col-actions { width: 20%; }

    /* Scheduler-specific: Project color ball */
    .project-color-ball {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 6px;
        vertical-align: middle;
    }

    /* Responsive - Scheduler-specific */
    @media (max-width: 870px) {
        .btn-new-task {
            margin-left: 0;
            justify-content: center;
        }

        /* Hide less important columns on mobile */
        .scheduler-task-table .col-project,
        .scheduler-task-table .col-lastrun {
            display: none;
        }

        /* Adjust remaining column widths */
        .scheduler-task-table .col-name { width: 45%; }
        .scheduler-task-table .col-state { width: 20%; }
        .scheduler-task-table .col-actions { width: 35%; }
    }
</style>
</body>
</html>

